{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}Import Users from CSV | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
    &rsaquo; <a href="{% url 'admin:auth_user_changelist' %}">Users</a>
    &rsaquo; Import CSV
</div>
{% endblock %}

{% block content %}
<h1>Import Users from CSV</h1>

<div class="module">
    <div class="form-row">
        <p>
            <strong>Instructions:</strong>
        </p>
        <ul>
            <li>Download the CSV template using the button below to ensure correct column names</li>
            <li>Column names are case-insensitive (e.g., "Email", "email", "EMAIL" all work)</li>
            <li>The second row indicates whether each field is Compulsory or Optional</li>
            <li>Required fields: <strong>email</strong> and <strong>phone_number</strong></li>
            <li>Username will be auto-generated from email if not provided</li>
            <li>Existing users (by email) will be updated instead of creating duplicates</li>
        </ul>
    </div>

    <div class="form-row" style="margin: 20px 0;">
        <a href="{% url 'admin:users_user_download_template' %}" class="button" style="padding: 10px 20px; text-decoration: none; background: #417690; color: white; border-radius: 4px;">
            ðŸ“¥ Download CSV Template
        </a>
    </div>

    <form method="post" enctype="multipart/form-data" style="margin-top: 20px;">
        {% csrf_token %}
        <fieldset class="module aligned">
            <div class="form-row">
                <div>
                    <label for="id_csv_file" style="display: block; margin-bottom: 8px; font-weight: bold;">
                        Select CSV File:
                    </label>
                    <input type="file" name="csv_file" id="id_csv_file" accept=".csv" required style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%; max-width: 400px;">
                    <p class="help" style="margin-top: 5px; color: #666;">
                        Only CSV files are accepted. Maximum file size depends on server settings.
                    </p>
                </div>
            </div>
        </fieldset>

        <div class="submit-row" style="margin-top: 20px;">
            <input type="submit" value="Upload and Import" class="default" style="padding: 10px 20px; background: #417690; color: white; border: none; border-radius: 4px; cursor: pointer;">
            <a href="{% url 'admin:auth_user_changelist' %}" class="button" style="padding: 10px 20px; text-decoration: none; background: #ba2121; color: white; border-radius: 4px; margin-left: 10px;">
                Cancel
            </a>
        </div>
    </form>

    <div class="module" style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
        <h2>CSV Format Requirements</h2>
        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
            <thead>
                <tr style="background: #e0e0e0;">
                    <th style="padding: 8px; text-align: left; border: 1px solid #ddd;">Column Name</th>
                    <th style="padding: 8px; text-align: left; border: 1px solid #ddd;">Status</th>
                    <th style="padding: 8px; text-align: left; border: 1px solid #ddd;">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;"><strong>email</strong></td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #ba2121;">Compulsory</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">User's email address (must be unique)</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;"><strong>phone_number</strong></td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #ba2121;">Compulsory</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">Phone number (7-15 digits, non-digits will be removed)</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">first_name</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">User's first name</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">last_name</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">User's last name</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">username</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">Auto-generated from email if not provided</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">country_code</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">Defaults to +91 if not provided</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">gender</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">male, female, other, or prefer_not_to_say</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">country</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">Country name</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">state</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">State or province</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">city</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">City name</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">zipcode</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">Postal/ZIP code</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">address_line1</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">Primary address line</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">address_line2</td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">Secondary address line</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;"><strong>instagram_profile_link</strong></td>
                    <td style="padding: 8px; border: 1px solid #ddd;"><span style="color: #417690;">Optional</span></td>
                    <td style="padding: 8px; border: 1px solid #ddd;">Instagram profile URL (e.g., https://instagram.com/username) or just username. Will create social media account if user has influencer profile.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

